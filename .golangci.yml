version: "2"
run:
  modules-download-mode: readonly

linters:
  enable:
    - gocyclo
    - nestif
    - prealloc
    - revive
    - staticcheck
    - lll # 行长度检查
    - wsl_v5
    - unconvert # 建议添加：移除不必要的类型转换
    - misspell # 建议添加：拼写检查
  disable:
    - funlen # 已在exclusions中针对_test.go禁用，这里明确禁用
  exclusions:
    generated: lax
    presets:
      - comments
      - common-false-positives
      - legacy
      - std-error-handling
    rules:
      - linters:
          - errcheck
          - gocyclo
          - ineffassign
          - revive
          - staticcheck
          - unused
        path: kitex_gen
      - linters:
          - funlen
          - gocyclo
          - gosec
        path: _test\.go
      - linters:
          - revive
        text: exported.*should have comment
        source: ^// Code generated by .* DO NOT EDIT\.$
      - linters:
          - lll
        source: "^//go:generate "
      - linters:
          - revive
        text: "context-as-argument: context.Context should be the first parameter of a function"
        path: gateway/internal/application/middleware/jwt_middleware/handlers.go

    paths:
      - .git
      - .vscode
      - .idea
      - bin
      - scripts
      - testdata
      - kitex_gen
      - build
      - third_party
      - third_party$
      - builtin$
      - examples$

issues:
  max-issues-per-linter: 0
  max-same-issues: 0

linters-settings:
  lll:
    line-length: 120 # 检查行长度限制
    tab-width: 1

  # 添加golines配置 - 这是关键！
  golines:
    max-len: 120 # 最大行长度，超过会自动换行
    no-refactor: false # 允许重构代码来实现换行
    formatter: gofumpt # 使用gofumpt作为基础格式化器

  # 优化gci配置
  gci:
    sections:
      - standard # 标准库
      - default # 第三方库
      - prefix(github.com/masonsxu/cloudwego-scaffold) # 请替换为您的项目前缀
    custom-order: true
    skip-generated: true # 跳过生成的文件

  # 优化goimports配置
  goimports:
    local-prefixes: github.com/masonsxu/cloudwego-scaffold # 请替换为您的项目前缀

  # 添加revive配置（可选）
  revive:
    rules:
      - name: line-length-limit
        disabled: false # 启用行长度限制规则
        arguments: [120] # 设置120字符限制

  settings:
    wsl_v5:
      allow-first-in-block: true
      allow-whole-block: false
      branch-max-lines: 2

formatters:
  enable:
    - gci
    - goimports
    - gofumpt
    - golines # 负责长行自动换行
    - swaggo
  exclusions:
    generated: lax
    paths:
      - .git
      - .vscode
      - .idea
      - bin
      - scripts
      - testdata
      - kitex_gen
      - build
      - third_party
      - third_party$
      - builtin$
      - examples$
